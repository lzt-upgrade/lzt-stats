// ==UserScript==
// @name LZT Stats
// @description Detailed statistics of your activity
// @description:en Detailed statistics of your activity
// @description:ru Подробная статистика вашей активности
// @version 2.0.0
// @author Toil
// @supportURL https://github.com/lzt-upgrade/lzt-stats/issues
// @match *://lolz.guru/*
// @match *://lolz.live/*
// @match *://zelenka.guru/*
// @match *://zelenka.market/*
// @match *://lzt.market/*
// @match *://lolz.market/*
// @connect api-stats.lztup.net
// @downloadURL https://github.com/lzt-upgrade/lzt-stats/raw/master/dist/lzt-stats.user.js
// @grant GM_xmlhttpRequest
// @grant GM_info
// @grant GM_addStyle
// @grant GM_setValue
// @grant GM_getValue
// @grant GM_deleteValue
// @grant GM_listValues
// @homepageURL https://github.com/lzt-upgrade/lzt-stats
// @icon https://cdn.toil.cc/lztup/brand/logo-mini.png
// @license MIT
// @namespace lzt-stats1
// @updateURL https://github.com/lzt-upgrade/lzt-stats/raw/master/dist/lzt-stats.user.js
// ==/UserScript==

(()=>{"use strict";new Set;const t="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;class e{_listeners="WeakMap"in t?new WeakMap:void 0;_observer=void 0;options;constructor(t){this.options=t}observe(t,e){return this._listeners.set(t,e),this._getObserver().observe(t,this.options),()=>{this._listeners.delete(t),this._observer.unobserve(t)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver((t=>{for(const s of t)e.entries.set(s.target,s),this._listeners.get(s.target)?.(s)})))}}e.entries="WeakMap"in t?new WeakMap:void 0;let s,n=!1;function o(t,e){t.appendChild(e)}function i(t,e,s){const n=function(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}(t);if(!n.getElementById(e)){const t=c("style");t.id=e,t.textContent=s,function(t,e){o(t.head||t,e),e.sheet}(n,t)}}function a(t,e,s){t.insertBefore(e,s||null)}function r(t){t.parentNode&&t.parentNode.removeChild(t)}function c(t){return document.createElement(t)}function l(t){return document.createTextNode(t)}function u(){return l(" ")}function d(t,e,s,n){return t.addEventListener(e,s,n),()=>t.removeEventListener(e,s,n)}function p(t,e,s){null==s?t.removeAttribute(e):t.getAttribute(e)!==s&&t.setAttribute(e,s)}function h(t,e){e=""+e,t.data!==e&&(t.data=e)}function m(t,e,s){t.classList.toggle(e,!!s)}function f(){}function $(t){return t()}function g(){return Object.create(null)}function v(t){t.forEach($)}function b(t){return"function"==typeof t}function w(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function y(t,e,s,n){return t[1]&&n?function(t,e){for(const s in e)t[s]=e[s];return t}(s.ctx.slice(),t[1](n(e))):s.ctx}function k(t){s=t}function x(t,e){const s=t.$$.callbacks[e.type];s&&s.slice().forEach((t=>t.call(this,e)))}new Map;const _=[],M=[];let j=[];const L=[],C=Promise.resolve();let S=!1;function E(t){j.push(t)}const I=new Set;let P=0;function T(){if(0!==P)return;const t=s;do{try{for(;P<_.length;){const t=_[P];P++,k(t),N(t.$$)}}catch(t){throw _.length=0,P=0,t}for(k(null),_.length=0,P=0;M.length;)M.pop()();for(let t=0;t<j.length;t+=1){const e=j[t];I.has(e)||(I.add(e),e())}j.length=0}while(_.length);for(;L.length;)L.pop()();S=!1,I.clear(),k(t)}function N(t){if(null!==t.fragment){t.update(),v(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(E)}}const A=new Set;let V,D;function F(){V={r:0,c:[],p:V}}function O(){V.r||v(V.c),V=V.p}function B(t,e){t&&t.i&&(A.delete(t),t.i(e))}function U(t,e,s,n){if(t&&t.o){if(A.has(t))return;A.add(t),V.c.push((()=>{A.delete(t),n&&(s&&t.d(1),n())})),t.o(e)}else n&&n()}function R(t){return void 0!==t?.length?t:Array.from(t)}function z(t){t&&t.c()}function Z(t,e,s){const{fragment:n,after_update:o}=t.$$;n&&n.m(e,s),E((()=>{const e=t.$$.on_mount.map($).filter(b);t.$$.on_destroy?t.$$.on_destroy.push(...e):v(e),t.$$.on_mount=[]})),o.forEach(E)}function q(t,e){const s=t.$$;null!==s.fragment&&(function(t){const e=[],s=[];j.forEach((n=>-1===t.indexOf(n)?e.push(n):s.push(n))),s.forEach((t=>t())),j=e}(s.after_update),v(s.on_destroy),s.fragment&&s.fragment.d(e),s.on_destroy=s.fragment=null,s.ctx=[])}function G(t,e,o,i,a,c,l=null,u=[-1]){const d=s;k(t);const p=t.$$={fragment:null,ctx:[],props:c,update:f,not_equal:a,bound:g(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:g(),dirty:u,skip_bound:!1,root:e.target||d.$$.root};l&&l(p.root);let h=!1;if(p.ctx=o?o(t,e.props||{},((e,s,...n)=>{const o=n.length?n[0]:s;return p.ctx&&a(p.ctx[e],p.ctx[e]=o)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](o),h&&function(t,e){-1===t.$$.dirty[0]&&(_.push(t),S||(S=!0,C.then(T)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(t,e)),s})):[],p.update(),h=!0,v(p.before_update),p.fragment=!!i&&i(p.ctx),e.target){if(e.hydrate){n=!0;const t=(m=e.target,Array.from(m.childNodes));p.fragment&&p.fragment.l(t),t.forEach(r)}else p.fragment&&p.fragment.c();e.intro&&B(t.$$.fragment),Z(t,e.target,e.anchor),n=!1,T()}var m;k(d)}function H(t,e,s,n){const o=s[t]?.type;if(e="Boolean"===o&&"boolean"!=typeof e?null!=e:e,!n||!s[t])return e;if("toAttribute"===n)switch(o){case"Object":case"Array":return null==e?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return null==e?null:e;default:return e}else switch(o){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":default:return e;case"Number":return null!=e?+e:e}}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(D=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(t,e,s){super(),this.$$ctor=t,this.$$s=e,s&&this.attachShadow({mode:"open"})}addEventListener(t,e,s){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){const s=this.$$c.$on(t,e);this.$$l_u.set(e,s)}super.addEventListener(t,e,s)}removeEventListener(t,e,s){if(super.removeEventListener(t,e,s),this.$$c){const t=this.$$l_u.get(e);t&&(t(),this.$$l_u.delete(e))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){if(await Promise.resolve(),!this.$$cn)return;function t(t){return()=>{let e;return{c:function(){e=c("slot"),"default"!==t&&p(e,"name",t)},m:function(t,s){a(t,e,s)},d:function(t){t&&r(e)}}}}const e={},s=function(t){const e={};return t.childNodes.forEach((t=>{e[t.slot||"default"]=!0})),e}(this);for(const o of this.$$s)o in s&&(e[o]=[t(o)]);for(const i of this.attributes){const l=this.$$g_p(i.name);l in this.$$d||(this.$$d[l]=H(l,i.value,this.$$p_d,"toProp"))}for(const u in this.$$p_d)u in this.$$d||void 0===this[u]||(this.$$d[u]=this[u],delete this[u]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});const n=()=>{this.$$r=!0;for(const t in this.$$p_d)if(this.$$d[t]=this.$$c.$$.ctx[this.$$c.$$.props[t]],this.$$p_d[t].reflect){const e=H(t,this.$$d[t],this.$$p_d,"toAttribute");null==e?this.removeAttribute(this.$$p_d[t].attribute||t):this.setAttribute(this.$$p_d[t].attribute||t,e)}this.$$r=!1};this.$$c.$$.after_update.push(n),n();for(const d in this.$$l)for(const h of this.$$l[d]){const m=this.$$c.$on(d,h);this.$$l_u.set(h,m)}this.$$l={}}}attributeChangedCallback(t,e,s){this.$$r||(t=this.$$g_p(t),this.$$d[t]=H(t,s,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then((()=>{this.$$cn||(this.$$c.$destroy(),this.$$c=void 0)}))}$$g_p(t){return Object.keys(this.$$p_d).find((e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t))||t}});class X{$$=void 0;$$set=void 0;$destroy(){q(this,1),this.$destroy=f}$on(t,e){if(!b(e))return f;const s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(e),()=>{const t=s.indexOf(e);-1!==t&&s.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const J=JSON.parse('{"tabs":{"per_year":"За год","per_month":"За месяц","per_week":"За неделю","per_day":"За день","chat":"Чат","settings":"Настройки"}}');function W(){return Math.floor(Date.now()/1e3)}const Y=new class{langs=["en_US","ru_RU"];maxLifeTime=5184e3;phrases={};repoLink="https://raw.githubusercontent.com/lzt-upgrade/lzt-stats";keys=()=>this.langs;async update(t){return!(!this.langs.includes(t)&&await GM_getValue("menu-lang")===t&&await GM_getValue("menu-phrases-timestamp",0)+this.maxLifeTime<W())&&await fetch(`${this.repoLink}/master/src/i18n/${t}/general.json`).then((t=>{if(200!==t.status)throw t.status;return t.json()})).then((async e=>(await GM_setValue("menu-phrases",e),await GM_setValue("menu-lang",t),await GM_setValue("menu-phrases-timestamp",W()),this.phrases=e,!0))).catch((async t=>(console.error("[LZTStats.i18n.update] Failed to get phrases",t),XenForo.alert(`[LZT Stats] Failed to get phrases: ${t}`,"",5e3),this.phrases=GM_getValue("menu-phrases",{}),!1)))}getFromLocale(t,e){const s=e.split(".").reduce(((t,e)=>{if("object"==typeof t&&t)return t[e]}),t);return void 0===s&&console.warn(`[LZTStats.i18n.getFromLocale] locale ${JSON.stringify(t)} doesn't contain phrase ${e}`),s}get(t){return this.getFromLocale(this.phrases,t)??this.getFromLocale(J,t)??t}};function K(t){i(t,"svelte-1ssuvwd",".tab.svelte-1ssuvwd{list-style:none;padding:10px;font-size:14px}")}function Q(t){let e,s,n,o;const i=t[2].default,l=function(t,e,s,n){if(t){const n=y(t,e,s,null);return t[0](n)}}(i,t,t[1]);return{c(){e=c("li"),l&&l.c(),p(e,"class","tab svelte-1ssuvwd"),m(e,"active",t[0])},m(i,r){a(i,e,r),l&&l.m(e,null),s=!0,n||(o=d(e,"click",t[3]),n=!0)},p(t,[n]){l&&l.p&&(!s||2&n)&&function(t,e,s,n,o,i){if(o){const a=y(e,s,n,i);t.p(a,o)}}(l,i,t,t[1],s?function(t,e,s,n){if(t[2]&&n){const o=t[2](n(s));if(void 0===e.dirty)return o;if("object"==typeof o){const t=[],s=Math.max(e.dirty.length,o.length);for(let n=0;n<s;n+=1)t[n]=e.dirty[n]|o[n];return t}return e.dirty|o}return e.dirty}(i,t[1],n,null):function(t){if(t.ctx.length>32){const e=[],s=t.ctx.length/32;for(let t=0;t<s;t++)e[t]=-1;return e}return-1}(t[1]),null),(!s||1&n)&&m(e,"active",t[0])},i(t){s||(B(l,t),s=!0)},o(t){U(l,t),s=!1},d(t){t&&r(e),l&&l.d(t),n=!1,o()}}}function tt(t,e,s){let{$$slots:n={},$$scope:o}=e,{isActive:i=!1}=e;return t.$$set=t=>{"isActive"in t&&s(0,i=t.isActive),"$$scope"in t&&s(1,o=t.$$scope)},[i,o,n,function(e){x.call(this,t,e)}]}const et=class extends X{constructor(t){super(),G(this,t,tt,Q,w,{isActive:0},K)}};function st(t){i(t,"svelte-16w30j",".stat-card.svelte-16w30j{display:flex;flex-direction:column;justify-content:space-between;flex:1 1 calc(100% / 3);background:#2D2D2D;border-radius:8px;padding:12px}.stat-head.svelte-16w30j{display:flex;align-items:center;margin-bottom:6px}.stat-icon.svelte-16w30j{font-size:20px;margin-right:6px}.stat-title.svelte-16w30j{font-weight:400;font-size:13px;line-height:16px;color:rgba(214, 214, 214, 0.80);margin-bottom:6px;max-width:100%}.stat-body.svelte-16w30j{display:flex;align-items:center}.stat-value.svelte-16w30j{margin:0}.stat-graph.svelte-16w30j{margin-left:auto}")}function nt(t){let e,s,n,i,d;return{c(){var o;e=c("div"),s=l(t[3]),n=u(),i=c("i"),p(i,"class",(o=t[4].class,d=(null==o?"":o)+" svelte-16w30j")),p(e,"class","stat-graph svelte-16w30j"),function(t,e,s,n){null==s?t.style.removeProperty(e):t.style.setProperty(e,s,"")}(e,"color",t[4].color)},m(t,r){a(t,e,r),o(e,s),o(e,n),o(e,i)},p(t,e){8&e&&h(s,t[3])},d(t){t&&r(e)}}}function ot(t){let e,s,n,i,d,m,$,g,v,b,w,y,k=null!==t[3]&&nt(t);return{c(){e=c("div"),s=c("div"),n=c("i"),d=u(),m=c("p"),$=l(t[1]),g=u(),v=c("div"),b=c("p"),w=l(t[2]),y=u(),k&&k.c(),p(n,"class",i="stat-icon "+t[0]+" svelte-16w30j"),p(m,"class","stat-title svelte-16w30j"),p(s,"class","stat-head svelte-16w30j"),p(b,"class","stat-value svelte-16w30j"),p(v,"class","stat-body svelte-16w30j"),p(e,"class","stat-card svelte-16w30j")},m(t,i){a(t,e,i),o(e,s),o(s,n),o(s,d),o(s,m),o(m,$),o(e,g),o(e,v),o(v,b),o(b,w),o(v,y),k&&k.m(v,null)},p(t,[e]){1&e&&i!==(i="stat-icon "+t[0]+" svelte-16w30j")&&p(n,"class",i),2&e&&h($,t[1]),4&e&&h(w,t[2]),null!==t[3]?k?k.p(t,e):(k=nt(t),k.c(),k.m(v,null)):k&&(k.d(1),k=null)},i:f,o:f,d(t){t&&r(e),k&&k.d()}}}function it(t,e,s){let{icon:n}=e,{name:o}=e,{value:i}=e,{graphValue:a=null}=e,r=function(t){switch(t){case 1:return{class:"fas fa-caret-up",color:"#0daf77"};case-1:return{class:"fas fa-caret-down",color:"#ea4c4c"};default:return{class:"far fa-arrows-alt-v",color:"#D6D6D6"}}}(Math.sign(a));return t.$$set=t=>{"icon"in t&&s(0,n=t.icon),"name"in t&&s(1,o=t.name),"value"in t&&s(2,i=t.value),"graphValue"in t&&s(3,a=t.graphValue)},[n,o,i,a,r]}const at=class extends X{constructor(t){super(),G(this,t,it,ot,w,{icon:0,name:1,value:2,graphValue:3},st)}};function rt(t){i(t,"svelte-11mfgnw",".tabs.svelte-11mfgnw{display:flex;align-items:center;justify-content:center;margin:0}.modal-body.svelte-11mfgnw{margin-top:10px}.stat-cards.svelte-11mfgnw{display:flex;flex-direction:row;justify-content:center;gap:12px}")}function ct(t,e,s){const n=t.slice();return n[5]=e[s],n[7]=s,n}function lt(t){let e,s=t[5].phrase+"";return{c(){e=l(s)},m(t,s){a(t,e,s)},p:f,d(t){t&&r(e)}}}function ut(t){let e,s;return e=new et({props:{isActive:t[0]===t[7],$$slots:{default:[lt]},$$scope:{ctx:t}}}),e.$on("click",(function(){return t[3](t[7])})),{c(){z(e.$$.fragment)},m(t,n){Z(e,t,n),s=!0},p(s,n){t=s;const o={};1&n&&(o.isActive=t[0]===t[7]),256&n&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){s||(B(e.$$.fragment,t),s=!0)},o(t){U(e.$$.fragment,t),s=!1},d(t){q(e,t)}}}function dt(t){let e;return{c(){e=c("p"),e.textContent="who"},m(t,s){a(t,e,s)},i:f,o:f,d(t){t&&r(e)}}}function pt(t){let e;return{c(){e=c("p"),e.textContent="penis"},m(t,s){a(t,e,s)},i:f,o:f,d(t){t&&r(e)}}}function ht(t){let e,s,n,i,l,d,h;return s=new at({props:{icon:"far fa-comment-alt",name:"Сообщений",value:77777,graphValue:111}}),i=new at({props:{icon:"far fa-comment-alt-edit",name:"Изменено сообщений",value:-77777,graphValue:-11}}),d=new at({props:{icon:"far fa-comment-alt-times",name:"Удалено сообщений",value:0,graphValue:0}}),{c(){e=c("div"),z(s.$$.fragment),n=u(),z(i.$$.fragment),l=u(),z(d.$$.fragment),p(e,"class","stat-cards svelte-11mfgnw")},m(t,r){a(t,e,r),Z(s,e,null),o(e,n),Z(i,e,null),o(e,l),Z(d,e,null),h=!0},i(t){h||(B(s.$$.fragment,t),B(i.$$.fragment,t),B(d.$$.fragment,t),h=!0)},o(t){U(s.$$.fragment,t),U(i.$$.fragment,t),U(d.$$.fragment,t),h=!1},d(t){t&&r(e),q(s),q(i),q(d)}}}function mt(t){return{c:f,m:f,d:f}}function ft(t){let e;return{c(){e=c("div"),e.textContent=`${t[4]}`},m(t,s){a(t,e,s)},d(t){t&&r(e)}}}function $t(t){return{c:f,m:f,d:f}}function gt(t){let e,n,i,d,h,m,f,$,g,v,b=R(t[1]),w=[];for(let e=0;e<b.length;e+=1)w[e]=ut(ct(t,b,e));const y=t=>U(w[t],1,1,(()=>{w[t]=null})),x=[ht,pt,dt],_=[];function M(t,e){return t[0]<4?0:4===t[0]?1:5===t[0]?2:-1}~(h=M(t))&&(m=_[h]=x[h](t));let j={ctx:t,current:null,token:null,hasCatch:!1,pending:$t,then:ft,catch:mt,value:4};return function(t,e){const n=e.token={};function o(t,s,o,i){if(e.token!==n)return;e.resolved=i;let a=e.ctx;void 0!==o&&(a=a.slice(),a[o]=i);const r=t&&(e.current=t)(a);let c=!1;e.block&&(e.blocks?e.blocks.forEach(((t,n)=>{n!==s&&t&&(F(),U(t,1,1,(()=>{e.blocks[n]===t&&(e.blocks[n]=null)})),O())})):e.block.d(1),r.c(),B(r,1),r.m(e.mount(),e.anchor),c=!0),e.block=r,e.blocks&&(e.blocks[s]=r),c&&T()}if(!(i=t)||"object"!=typeof i&&"function"!=typeof i||"function"!=typeof i.then){if(e.current!==e.then)return o(e.then,1,e.value,t),!0;e.resolved=t}else{const n=function(){if(!s)throw new Error("Function called outside component initialization");return s}();if(t.then((t=>{k(n),o(e.then,1,e.value,t),k(null)}),(t=>{if(k(n),o(e.catch,2,e.error,t),k(null),!e.hasCatch)throw t})),e.current!==e.pending)return o(e.pending,0),!0}var i}(g=Y.update("en_US"),j),{c(){e=c("div"),n=c("ul");for(let t=0;t<w.length;t+=1)w[t].c();i=u(),d=c("div"),m&&m.c(),f=u(),$=l(""),j.block.c(),p(n,"class","tabs svelte-11mfgnw"),p(e,"class","modal-head"),p(d,"class","modal-body svelte-11mfgnw")},m(t,s){a(t,e,s),o(e,n);for(let t=0;t<w.length;t+=1)w[t]&&w[t].m(n,null);a(t,i,s),a(t,d,s),~h&&_[h].m(d,null),a(t,f,s),a(t,$,s),j.block.m(t,j.anchor=s),j.mount=()=>$.parentNode,j.anchor=$,v=!0},p(e,[s]){if(t=e,3&s){let e;for(b=R(t[1]),e=0;e<b.length;e+=1){const o=ct(t,b,e);w[e]?(w[e].p(o,s),B(w[e],1)):(w[e]=ut(o),w[e].c(),B(w[e],1),w[e].m(n,null))}for(F(),e=b.length;e<w.length;e+=1)y(e);O()}let o=h;h=M(t),h!==o&&(m&&(F(),U(_[o],1,1,(()=>{_[o]=null})),O()),~h?(m=_[h],m||(m=_[h]=x[h](t),m.c()),B(m,1),m.m(d,null)):m=null)},i(t){if(!v){for(let t=0;t<b.length;t+=1)B(w[t]);B(m),v=!0}},o(t){w=w.filter(Boolean);for(let t=0;t<w.length;t+=1)U(w[t]);U(m),v=!1},d(t){t&&(r(e),r(i),r(d),r(f),r($)),function(t,e){for(let s=0;s<t.length;s+=1)t[s]&&t[s].d(e)}(w,t),~h&&_[h].d(),j.block.d(t),j.token=null,j=null}}}function vt(t,e,s){console.log(Y.keys()),console.log(Y.get("tabs.per_year"));let{lang:n}=e,o=0;return t.$$set=t=>{"lang"in t&&s(2,n=t.lang)},[o,[{phrase:"За год",period:31104e3},{phrase:"За месяц",period:2592e3},{phrase:"За неделю",period:604800},{phrase:"За день",period:86400},{phrase:"Чат",period:-1},{phrase:"Настройки",period:-1}],n,t=>s(0,o=t)]}const bt=class extends X{constructor(t){super(),G(this,t,vt,gt,w,{lang:2},rt)}};function wt(t){i(t,"svelte-hx4j36","#LZTStatsButton.svelte-hx4j36{color:#0daf77;font-weight:600}")}function yt(t){let e,s,n;return{c(){e=c("a"),e.textContent="LZT Stats",p(e,"id","LZTStatsButton"),p(e,"class","svelte-hx4j36")},m(o,i){a(o,e,i),s||(n=d(e,"click",t[0]),s=!0)},p:f,i:f,o:f,d(t){t&&r(e),s=!1,n()}}}function kt(t,e,s){let{lang:n}=e;const o=document.createElement("div");return new bt({target:o}),t.$$set=t=>{"lang"in t&&s(1,n=t.lang)},[function(){XenForo.alert('<div id="lzt-stats-modal"></div>',"LZT Stats",null,(()=>{document.querySelector("div.modal.fade")?.remove()}));const t=document.getElementById("lzt-stats-modal");new bt({target:t,props:{lang:n}})},n]}const xt=class extends X{constructor(t){super(),G(this,t,kt,yt,w,{lang:1},wt)}},_t=class{static isMessage=t=>/^threads\/([^d]+)\/add-reply$/.test(t);static isComment=t=>/^posts\/([^d]+)\/comment$/.test(t);static isDeleteMessage=t=>/^posts\/([^d]+)\/delete$/.test(t);static isDeleteComment=t=>/^posts\/comments\/([^d]+)\/delete$/.test(t);static isEditMessage=t=>/^posts\/([^d]+)\/save-inline$/.test(t);static isEditComment=t=>/^posts\/comments\/([^d]+)\/save-inline$/.test(t);static isParticipate=t=>/^threads\/([^d]+)\/participate/.test(t);static isSympathyOrLike=t=>/\/posts\/([^d]+)\/like$/.test(t);static isReport=t=>/^posts\/([^d]+)\/report$/.test(t);static isPollVote=t=>/^threads\/([^d]+)\/poll\/vote/.test(t);static isCreate=t=>/^forums\/([-\w]+)\/add-thread$/.test(t);static isEdit=t=>/^threads\/([^d]+)\/save$/.test(t);static isDelete=t=>/^threads\/([^d]+)\/delete$/.test(t);static getThreadId(t){const e=t.match(/^threads\/([^d]+)\//)?.[1]?.split("/")?.[0];return Number(e)||0}static getPostId(t){const e=t.match(/^posts\/([^d]+)\//)?.[1]?.split("/")?.[0];return Number(e)||0}static getPostIdByFullURL(t){const e=t.match(/\/posts\/([^d]+)\//)?.[1]?.split("/")?.[0];return Number(e)||0}static getCommentPostId(t){const e=t.match(/^posts\/comments\/([^d]+)\//)?.[1]?.split("/")?.[0];return Number(e)||0}static getForumId(t){const e=t.match(/^forums\/([-\w]+)\//)?.[1]?.split("/")?.[0];return String(e)||0}},Mt=class{static isLike=t=>/\/profile-posts\/([^d]+)\/like$/.test(t);static isMessageByUserId=t=>/^members\/([^d]+)\/post$/.test(t);static isMessageByShortLink=t=>/^([-\w]+)\/post$/.test(t);static isComment=t=>/^profile-posts\/([^d]+)\/comment$/.test(t);static isPollVote=t=>/^profile-posts\/([^d]+)\/poll\/vote/.test(t);static getPostId(t){const e=t.match(/^profile-posts\/([^d]+)\//)?.[1]?.split("/")?.[0];return Number(e)||0}static getUserId(t){const e=t.match(/^([-\w]+)\/post$/)||t.match(/^members\/([^d]+)\//),s=e?.[1]?.split("/")?.[0];return String(s)||0}},jt=class{static isMessage=t=>/^\/chatbox\/post-message$/.test(t);static isDeleteMessage=t=>/^\/chatbox\/([^d]+)\/delete$/.test(t);static isEditMessage=t=>/^\/chatbox\/([^d]+)\/edit$/.test(t);static getChatId(t){const e=t.match(/^\/chatbox\/([^d]+)\//)?.[1]?.split("/")?.[0];return Number(e)||0}},Lt=class{static isMessage=t=>/^conversations\/([^d]+)\/insert-reply$/.test(t);static isEditMessage=t=>/^conversations\/([^d]+)\/save-message/.test(t);static getConversationId(t){const e=t.match(/^conversations\/([^d]+)\//)?.[1]?.split("/")?.[0];return Number(e)||0}};function Ct(t,e){console.debug("[LZTStats.saveStats]",t);let s=GM_getValue(e,[]);s.push(t),GM_setValue(e,s)}function St(t){return t.innerText.includes("Это нравится Вам")||t.innerText.includes("Вам нравится это")||t.innerText.includes("You like this")||t.innerText.includes("You and")||t.innerText.includes("You,")}function Et(t){return(new DOMParser).parseFromString(t,"text/html")}const It=class{static init(){const t=XenForo.ajax;XenForo.ajax=function(){console.debug("[LZTStats.AjaxHook]",arguments);const e=arguments[0],s=arguments[1],n=W();switch(!0){case _t.isMessage(e):Ct({id:_t.getThreadId(e),timestamp:n},"stats-messages");break;case _t.isComment(e):Ct({id:_t.getPostId(e),timestamp:n},"stats-comments");break;case _t.isParticipate(e):Ct({id:_t.getThreadId(e),timestamp:n},"stats-participates");break;case _t.isReport(e):Ct({id:_t.getPostId(e),timestamp:n},"stats-reports");break;case _t.isCreate(e):Ct({id:_t.getForumId(e),timestamp:n},"stats-threads-created");break;case _t.isEdit(e):Ct({id:_t.getThreadId(e),timestamp:n},"stats-threads-edited");break;case _t.isDelete(e):Ct({id:_t.getThreadId(e),timestamp:n},"stats-threads-deleted");break;case _t.isDeleteComment(e)&&s.length>0:Ct({id:_t.getCommentPostId(e),timestamp:n},"stats-comments-deleted");break;case _t.isDeleteMessage(e)&&s.length>0:Ct({id:_t.getPostId(e),timestamp:n},"stats-messages-deleted");break;case _t.isEditComment(e):Ct({id:_t.getCommentPostId(e),timestamp:n},"stats-comments-edited");break;case _t.isEditMessage(e):Ct({id:_t.getPostId(e),timestamp:n},"stats-messages-edited");break;case(_t.isPollVote(e)||Mt.isPollVote(e))&&s.length>0:Ct({id:_t.isPollVote(e)?_t.getThreadId(e):Mt.getPostId(e),timestamp:n},"stats-polls");break;case Mt.isMessageByUserId(e)||Mt.isMessageByShortLink(e)&&window.location.pathname.replace("/","")+"/post"===e:Ct({id:Mt.getUserId(e),timestamp:n},"stats-messages");break;case Mt.isComment(e):Ct({id:_t.getCommentPostId(e),timestamp:n},"stats-comments");break;case jt.isMessage(e):Ct({id:0,message:s?.message,timestamp:n},"stats-chat");break;case jt.isEditMessage(e):Ct({id:jt.getChatId(e),timestamp:n},"stats-chat-edited");break;case jt.isDeleteMessage(e):Ct({id:jt.getChatId(e),timestamp:n},"stats-chat-deleted");break;case Lt.isMessage(e):Ct({id:Lt.getConversationId(e),timestamp:n},"stats-conversation");break;case Lt.isEditMessage(e):Ct({id:Lt.getConversationId(e),timestamp:n},"stats-conversation-edited")}const o=t.apply(this,arguments);return o.then((t=>{switch(!0){case _t.isSympathyOrLike(e):{const s=_t.getPostIdByFullURL(e),o=Et(t.templateHtml),i=o.querySelector(".likeCountLeft"),a=o.querySelector(".likeText");a&&St(a)&&Ct({id:s,timestamp:n},i?"stats-sympathies-new":"stats-likes");break}case Mt.isLike(e):{const s=_t.getPostIdByFullURL(e),o=Et(t.templateHtml).querySelector(".likeText");o&&St(o)&&Ct({id:s,timestamp:n},"stats-likes");break}}})),o}}};(new class{constructor(){this.lang=1===XenForo?.visitor?.language_id?"en_US":"ru_RU"}init(){It.init(),this.render()}render(){const t=document.querySelector("#AccountMenu > ul:nth-child(1) > li:nth-child(10)"),e=document.createElement("li");new xt({target:e,props:{lang:this.lang}}),t.insertAdjacentElement("afterend",e)}}).init()})();